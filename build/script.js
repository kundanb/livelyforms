"use strict";function _slicedToArray(t,n){return _arrayWithHoles(t)||_iterableToArrayLimit(t,n)||_unsupportedIterableToArray(t,n)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,n){if(t){if("string"==typeof t)return _arrayLikeToArray(t,n);var r=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(r="Object"===r&&t.constructor?t.constructor.name:r)||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(t,n):void 0}}function _arrayLikeToArray(t,n){(null==n||n>t.length)&&(n=t.length);for(var r=0,a=new Array(n);r<n;r++)a[r]=t[r];return a}function _iterableToArrayLimit(t,n){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var a,e,i=[],u=!0,o=!1;try{for(r=r.call(t);!(u=(a=r.next()).done)&&(i.push(a.value),!n||i.length!==n);u=!0);}catch(t){o=!0,e=t}finally{try{u||null==r.return||r.return()}finally{if(o)throw e}}return i}}function _arrayWithHoles(t){if(Array.isArray(t))return t}var _console=console,log=_console.log,Pi=Math.PI,random=Math.random,min=Math.min,max=Math.max,abs=Math.abs,sqrt=Math.sqrt,floor=Math.floor,round=Math.round,ceil=Math.ceil,sin=Math.sin,cos=Math.cos,tan=Math.tan,Pi2=2*Pi,Deg=Pi2/360,rand=function(t,n){return random()*(n-t)+t},randInt=function(t,n){return Math.round(rand(t,n))},randSign=function(t){return t*[-1,1][randInt(0,1)]},mkArr=function(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return Array(t).fill(n)},callNGet=function(t){return t(),t};function HSL(t,n,r){var a=this;this.h=null!=t?t:0,this.s=null!=n?n:100,this.l=null!=r?r:50,this.str=function(){return"hsl(".concat(a.h,", ").concat(a.s,"%, ").concat(a.l,"%)")}}var cw,ch,hfcw,hfch,canvas=document.getElementById("canvas"),canvasCtx=canvas.getContext("2d"),resizeCanvas=function(){canvas.width=window.innerWidth,canvas.height=window.innerHeight,cw=canvas.width,ch=canvas.height,hfcw=cw/2,hfch=ch/2};resizeCanvas(),window.addEventListener("resize",resizeCanvas);var aud=new Audio;aud.src="audio.webm",aud.load();var audPicker=document.getElementById("audio-picker"),audInput=document.getElementById("audio-input");audPicker.onclick=function(){return audInput.click()},audInput.onchange=function(t){t=_slicedToArray(t.target.files,1)[0];t&&(aud.src=URL.createObjectURL(t)),aud.load(),aud.play()};var audCtx=new AudioContext,audAzr=audCtx.createAnalyser(),audSrc=audCtx.createMediaElementSource(aud);audSrc.connect(audAzr),audAzr.connect(audCtx.destination);var activeEqGrp,audDatLen=audAzr.frequencyBinCount,audDat=new Uint8Array(audDatLen),audDatMod=mkArr(audDatLen),audDatAvg=0,updateAudDat=function(){audAzr.getByteTimeDomainData(audDat),audDatMod=[].slice.call(audDat).map(function(t){return abs(t-128)/128}),audDatAvg=audDatMod.reduce(function(t,n){return t+n},0)/audDatLen},xy=function(t,n,r){return{x:t.x*r,y:t.y*r}},r2xy=function(t,n,r){return{x:hfcw+t*cos(n)*r,y:hfch+t*sin(n)*r}},eqGrps=[{id:0,s:15,t:Pi2,xy:r2xy,eqGrp:[function(t){return 8+7*sin(t)},function(t){return 8+7*cos(t)},function(t){return 8-7*sin(t)},function(t){return 8-7*sin(t)}]},{id:1,s:20,t:20*Pi,xy:r2xy,eqGrp:[function(t){return 10+sin(Pi2*t)}]},{id:2,s:250,t:Pi2,xy:r2xy,eqGrp:[function(t){return sin(6*t)},function(t){return cos(6*t)}]},{id:3,s:20,t:Pi2,xy:r2xy,eqGrp:mkArr(12).map(function(t,n){return function(t){return(n+1)*cos(6*t)}})},{id:4,s:50,t:Pi2,xy:r2xy,eqGrp:[function(t){return 2+cos(6*t)},function(t){return 4+cos(6*t)}]},{id:5,s:10,t:Pi2,xy:r2xy,eqGrp:mkArr(12).map(function(t,n){return function(t){return 12+(n+1)*sin(7*t)}})},{id:6,s:10,t:Pi2,xy:r2xy,eqGrp:[function(t){return.5},function(t){return 3-2*abs(cos(5*t+Pi))},function(t){return 6-min(abs(tan(5*t+Pi))/10,3)},function(t){return 8-min(abs(tan(t+Pi))/20,5)},function(t){return 10+min(abs(tan(t+Pi))/10,3)},function(t){return 16-min(abs(tan(t+Pi))/10,3)},function(t){return 22-min(abs(tan(t+Pi))/10,9)},function(t){return 7-min(abs(tan(t+Pi))/20,3)+.5*sin(20*t-Pi/2)},function(t){return max(22+abs(tan(Math.pow(20*t,2))),22)-min(abs(tan(t+Pi))/10,9)}]},{id:7,s:20,t:Pi2,xy:r2xy,eqGrp:[function(t){return 1},function(t){return 2+cos(6*t+Pi)},function(t){return 4+cos(6*t)},function(t){return 6+cos(6*t+Pi)},function(t){return 8+cos(6*t)},function(t){return 10+cos(6*t+Pi)},function(t){return 11.5+.99*cos(6*t)*.5}]}],changePolEqGrp=callNGet(function(){for(var t;(t=eqGrps[randInt(0,eqGrps.length-1)])===activeEqGrp;);activeEqGrp=t,console.log("Active Equation Group:",activeEqGrp)}),pCount=2*audDatLen,pMedIdxOff=audDatLen/pCount,pColor=new HSL(0,0,50),pSmooth=10,pFluid=.8,pColorStr=pColor.str();function Particle(t){var r=this;this.x=hfcw,this.y=hfch,this.t=null,this.s=1,this.eq=null,this.r=1,this.sw=1,this.medIdx=t,this.draw=function(){canvasCtx.strokeStyle=pColorStr,canvasCtx.lineWidth=r.sw,canvasCtx.beginPath(),canvasCtx.arc(r.x,r.y,r.r,0,Pi2),canvasCtx.stroke()},this.update=function(){var t=audDatMod[r.medIdx]*audDatAvg*5;r.s=1.5*t+1,r.t+=Deg/4,r.r=9*t+1;var n=activeEqGrp,t=n.xy,n=n.s,n=t(r.eq(r.t),r.t,n*r.s);r.x+=(n.x-r.x)/pSmooth,r.y+=(n.y-r.y)/pSmooth}}var particles=mkArr(pCount).map(function(t,n){return new Particle(floor(n*pMedIdxOff))}),setParticles=callNGet(function(){for(var t=activeEqGrp.eqGrp,n=activeEqGrp.t/pCount*t.length,r=0;r<pCount;r+=t.length)for(var a=0;a<t.length;a++){var e=particles[r+a];e&&(e.t=r*n,e.eq=t[a])}});setInterval(function(){changePolEqGrp(),setParticles()},5e3);var drawParticles=function(){canvasCtx.fillStyle="rgba(0, 0, 0, ".concat(1-pFluid,")"),canvasCtx.fillRect(0,0,cw,ch),particles.forEach(function(t){return t.draw()})},updateParticles=function(){pColor.s=75*audDatAvg+25,pColor.h++,pColorStr=pColor.str(),particles.forEach(function(t){return t.update()})},animate=function t(){updateAudDat(),drawParticles(),updateParticles(),setTimeout(t,1e3/60)};animate(),document.onkeydown=function(t){audCtx.resume(),"Space"===t.code&&aud[aud.paused?"play":"pause"](),"ArrowLeft"===t.code&&(aud.currentTime-=10),"ArrowRight"===t.code&&(aud.currentTime+=10)},canvas.onclick=function(){audCtx.resume(),aud[aud.paused?"play":"pause"]()};